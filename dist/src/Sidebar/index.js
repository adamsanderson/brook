import{g as ie,P as i,j as s,R as d,f as j,A as U,O as B,B as V,r as w,c as p,d as z,e as E,h as O,F as _,k as D,l as oe,V as W,u as g,m as ae,n as le,p as de,q as K,t as ce,v as pe,w as he,C as ue,T as fe,x as me,y as H,z as ge,D as xe,E as je,G as ye,H as be,I as J,J as ve,K as P,L as we,M as Ce,N as Re,Q as Fe,S as Se,U as ke,W as Me,i as Ne,a as Te,b as Ee,X as Oe}from"../../store.js";import{R as $,E as C,P as De}from"../../ProxyStoreProvider.js";var F,I;function Pe(){if(I)return F;I=1;var r=typeof Element<"u",e=typeof Map=="function",t=typeof Set=="function",n=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function o(a,l){if(a===l)return!0;if(a&&l&&typeof a=="object"&&typeof l=="object"){if(a.constructor!==l.constructor)return!1;var h,c,m;if(Array.isArray(a)){if(h=a.length,h!=l.length)return!1;for(c=h;c--!==0;)if(!o(a[c],l[c]))return!1;return!0}var x;if(e&&a instanceof Map&&l instanceof Map){if(a.size!==l.size)return!1;for(x=a.entries();!(c=x.next()).done;)if(!l.has(c.value[0]))return!1;for(x=a.entries();!(c=x.next()).done;)if(!o(c.value[1],l.get(c.value[0])))return!1;return!0}if(t&&a instanceof Set&&l instanceof Set){if(a.size!==l.size)return!1;for(x=a.entries();!(c=x.next()).done;)if(!l.has(c.value[0]))return!1;return!0}if(n&&ArrayBuffer.isView(a)&&ArrayBuffer.isView(l)){if(h=a.length,h!=l.length)return!1;for(c=h;c--!==0;)if(a[c]!==l[c])return!1;return!0}if(a.constructor===RegExp)return a.source===l.source&&a.flags===l.flags;if(a.valueOf!==Object.prototype.valueOf&&typeof a.valueOf=="function"&&typeof l.valueOf=="function")return a.valueOf()===l.valueOf();if(a.toString!==Object.prototype.toString&&typeof a.toString=="function"&&typeof l.toString=="function")return a.toString()===l.toString();if(m=Object.keys(a),h=m.length,h!==Object.keys(l).length)return!1;for(c=h;c--!==0;)if(!Object.prototype.hasOwnProperty.call(l,m[c]))return!1;if(r&&a instanceof Element)return!1;for(c=h;c--!==0;)if(!((m[c]==="_owner"||m[c]==="__v"||m[c]==="__o")&&a.$$typeof)&&!o(a[m[c]],l[m[c]]))return!1;return!0}return a!==a&&l!==l}return F=function(l,h){try{return o(l,h)}catch(c){if((c.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw c}},F}var Ae=Pe();const qe=ie(Ae);R.propTypes={isUnread:i.bool,hasError:i.bool,isLoading:i.bool};function R({isUnread:r,hasError:e,isLoading:t}){const n=r?"isUnread":"isRead",o=e?"hasError":"",a=t?"isLoading":"",l=e?"Error":r?"Unread":"Read";return s.jsxs("svg",{className:`Icon StatusIndicator ${n} ${o} ${a}`,xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32","aria-labelledby":"title",children:[s.jsx("title",{id:"title",children:l}),s.jsx("circle",{cx:"16",cy:"16",r:"8"})]})}class Le extends d.PureComponent{static propTypes={feed:i.object.isRequired,onRename:i.func};constructor(e){super(e),this.handleSubmit=this.handleSubmit.bind(this),this.handleKey=this.handleKey.bind(this)}componentDidMount(){this.input.select()}render(){const e=j.selectors.getFeedTitle(this.props.feed);return s.jsx("input",{defaultValue:e,ref:t=>this.input=t,onBlur:this.handleSubmit,onKeyUp:this.handleKey})}handleSubmit(){const e=this.props.onRename;e&&e(this.props.feed,this.input.value)}handleKey(e){if(e.keyCode===13)this.handleSubmit();else if(e.keyCode===27){const t=j.selectors.getFeedTitle(this.props.feed);this.input.value=t,this.input.blur()}}}class $e extends d.Component{static propTypes={feed:i.object.isRequired,isUnread:i.bool,onClick:i.func,onRename:i.func,style:i.object,className:i.string};static defaultProps={isUnread:!1,className:""};shouldComponentUpdate(e){return this.props===e?!1:this.props.className!==e.className||this.props.style!==e.style||this.props.onClick!==e.onClick||this.props.isUnread!==e.isUnread||!qe(this.props.feed,e.feed)}constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}render(){const{feed:e,isUnread:t,style:n,className:o,onRename:a}=this.props,l=t?"isUnread":"isRead",h=e.error;return s.jsxs("div",{className:`Feed ${l} ${o}`,style:n,onClick:this.handleClick,children:[s.jsx(R,{isUnread:t,hasError:!!h,isLoading:e.isLoading}),e.isEditing?s.jsx(Le,{feed:e,onRename:a}):h?this.renderError(e):this.renderFeed(e)]})}renderError(e){const t=j.selectors.getFeedTitle(e);return this.renderFeedElement({title:e.error,className:"hasError",href:e.url,children:t})}renderFeed(e){const t=j.selectors.getFeedTitle(e);return this.renderFeedElement({title:t,href:e.url,children:t})}renderFeedElement(e){return this.props.onClick?s.jsx("a",{...e,onClick:Ie}):s.jsx("span",{...e})}handleClick(e){this.props.onClick&&this.props.onClick(this.props.feed)}}function Ie(r){r.preventDefault()}const X={[V]:"isHoveringBefore",[B]:"isHoveringOver",[U]:"isHoveringAfter"};function S(r){const t=r.dataTransfer.getData("application/brook");if(t)return JSON.parse(t)}function G(r,e=.2){const t=r.target.getBoundingClientRect(),n={x:r.clientX,y:r.clientY};return Ue(t,n,e)}function Ue(r,e,t){const n=(e.y-r.top)/r.height;return n<=t?V:n>=1-t?U:B}class Be extends d.Component{static propTypes={onDrop:i.func.isRequired,allowDrop:i.func.isRequired,feed:i.object.isRequired,className:i.string};constructor(e){super(e),this.handleDragStart=this.handleDragStart.bind(this),this.handleDragOver=this.handleDragOver.bind(this),this.handleDragLeave=this.handleDragLeave.bind(this),this.handleDrop=this.handleDrop.bind(this),this.state={position:void 0}}render(){const{className:e,...t}=this.props,n=this.state.position,o=X[n];return s.jsx("div",{onDragStart:this.handleDragStart,draggable:!0,onDragOver:this.handleDragOver,onDragLeave:this.handleDragLeave,onDrop:this.handleDrop,children:s.jsx($e,{...t,className:[e,o].join(" ")})})}handleDragStart(e){e.dataTransfer.setData("text/html",e.currentTarget),e.dataTransfer.setData("application/brook",JSON.stringify(this.props.feed)),e.dataTransfer.effectAllowed="move"}handleDrop(e){const t=S(e),n=this.state.position,o=this.props.feed;this.props.onDrop(t,o,n,e),this.setState({position:void 0})}handleDragLeave(e){this.setState({position:void 0})}handleDragOver(e){const t=S(e);t&&this.props.allowDrop(t,this.props.feed)&&(this.setState({position:G(e,.5)}),e.preventDefault())}}Q.propTypes={expanded:i.bool};function Q({expanded:r}){const e=r?"isExpanded":"isCollapsed";return s.jsxs("svg",{className:"Icon Folder "+e,xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32","aria-labelledby":"title",children:[s.jsx("title",{id:"title",children:"Folder"}),s.jsx("path",{d:"M 6,6 L 20,16 L 6,26"})]})}class Ve extends d.PureComponent{static propTypes={folder:i.object.isRequired,onRename:i.func};constructor(e){super(e),this.handleSubmit=this.handleSubmit.bind(this),this.handleKey=this.handleKey.bind(this)}componentDidMount(){this.input.select()}render(){const{folder:e}=this.props;return s.jsx("input",{defaultValue:e.title,ref:t=>this.input=t,onBlur:this.handleSubmit,onKeyUp:this.handleKey})}handleSubmit(){const e=this.props.onRename;e&&e(this.props.folder,this.input.value)}handleKey(e){e.keyCode===13?this.handleSubmit():e.keyCode===27&&(this.input.value=this.props.folder.title,this.input.blur())}}class ze extends d.PureComponent{static propTypes={folder:i.object.isRequired,onClick:i.func,onRename:i.func,style:i.object,className:i.string};constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}render(){const{folder:e,style:t,className:n,onRename:o}=this.props;return s.jsxs("div",{className:`Folder ${n}`,style:t,onClick:this.handleClick,children:[s.jsx(Q,{expanded:e.expanded}),e.isEditing?s.jsx(Ve,{folder:e,onRename:o}):s.jsx("span",{children:e.title})]})}handleClick(e){this.props.onClick(this.props.folder)}}class _e extends d.Component{static propTypes={onDrop:i.func.isRequired,allowDrop:i.func.isRequired,folder:i.object.isRequired,className:i.string};constructor(e){super(e),this.handleDragStart=this.handleDragStart.bind(this),this.handleDragOver=this.handleDragOver.bind(this),this.handleDragLeave=this.handleDragLeave.bind(this),this.handleDrop=this.handleDrop.bind(this),this.state={position:void 0}}render(){const{className:e,...t}=this.props,n=this.state.position,o=X[n];return s.jsx("div",{onDragStart:this.handleDragStart,draggable:!0,onDragOver:this.handleDragOver,onDragLeave:this.handleDragLeave,onDrop:this.handleDrop,children:s.jsx(ze,{...t,className:[e,o].join(" ")})})}handleDragStart(e){e.dataTransfer.setData("text/html",e.currentTarget),e.dataTransfer.setData("application/brook",JSON.stringify(this.props.folder)),e.dataTransfer.effectAllowed="move"}handleDrop(e){const t=JSON.parse(e.dataTransfer.getData("application/brook")),n=this.state.position,o=this.props.folder;this.props.onDrop(t,o,n,e),this.setState({position:void 0})}handleDragLeave(e){this.setState({position:void 0})}handleDragOver(e){const t=S(e);t&&this.props.allowDrop(t,this.props.folder)&&(this.setState({position:G(e,.2)}),e.preventDefault())}}function k(){return k=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},k.apply(this,arguments)}function We(r,e){if(r==null)return{};var t=Ke(r,e),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}function Ke(r,e){if(r==null)return{};var t={},n=Object.keys(r),o,a;for(a=0;a<n.length;a++)o=n[a],!(e.indexOf(o)>=0)&&(t[o]=r[o]);return t}var A=w.forwardRef(function(r,e){var t=r.color,n=t===void 0?"currentColor":t,o=r.size,a=o===void 0?24:o,l=We(r,["color","size"]);return d.createElement("svg",k({ref:e,xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},l),d.createElement("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),d.createElement("polyline",{points:"12 19 5 12 12 5"}))});A.propTypes={color:i.string,size:i.oneOfType([i.string,i.number])};A.displayName="ArrowLeft";class He extends d.Component{static propTypes={closeModal:i.func.isRequired,backMessage:i.string,children:i.node.isRequired};static defaultProps={backMessage:"Back to Feeds"};render(){const{closeModal:e,backMessage:t,children:n}=this.props;return s.jsxs("div",{className:"Modal FullPageLayout inverted layout-vertical",children:[s.jsx("p",{className:"Panel-header",children:s.jsxs("a",{onClick:e,children:[s.jsx(A,{className:"Icon"})," "+t]})}),s.jsx("div",{className:"Panel-body",children:n})]})}}const Je=(r,e)=>({}),Y=p(Je,{closeModal:z})(He);class Xe extends d.Component{static propTypes={feeds:i.array.isRequired,onSubscribe:i.func.isRequired};render(){return s.jsx("ul",{className:"List",children:this.props.feeds.map(e=>{const t=j.selectors.getFeedTitle(e);return s.jsxs("li",{className:"List-item",children:[s.jsx(R,{}),s.jsx("a",{onClick:n=>this.props.onSubscribe(e),title:t,children:t})]},e.url)})})}}class Ge extends d.Component{static propTypes={feeds:i.array.isRequired,closeModal:i.func.isRequired,addFeed:i.func.isRequired};render(){return s.jsxs(Y,{...this.props,children:[s.jsx("p",{children:"Subscribe to:"}),s.jsx(Xe,{feeds:this.props.feeds,onSubscribe:this.handleSubscription})]})}handleSubscription=e=>{this.props.closeModal(),this.props.addFeed(e,{fetch:!0})}}const Qe=(r,e)=>({}),Ye=p(Qe,{addFeed:E})(Ge);class Ze extends d.Component{static propTypes={closeModal:i.func.isRequired,addFeed:i.func.isRequired};state={url:""};render(){const e=this.state.url;return s.jsxs(Y,{...this.props,children:[s.jsx("p",{children:"Manually add a feed:"}),s.jsxs("div",{className:"layout-horizontal layout-gap",children:[s.jsx("input",{className:"layout-flex-1",type:"url",placeholder:"http://example.com/feed",value:e,onChange:this.handleUrlChange}),s.jsx("button",{className:"Button isActive",onClick:this.handleAdd,disabled:e.length<3,children:"Add"})]})]})}handleUrlChange=e=>{this.setState({url:e.target.value})};handleAdd=e=>{this.props.closeModal(),this.props.addFeed({url:this.state.url},{fetch:!0})}}const et=(r,e)=>({}),tt=p(et,{addFeed:E})(Ze);class rt{constructor(e){const n=document.implementation.createDocument("","opml",null);this.doc=n,n.prepend(this.doc.createProcessingInstruction("xml",'version="1.0" encoding="ISO-8859-1"')),this.head=this._createHead(e),this.body=this._createBody()}getRoot(){return this.doc.children[0]}addFolder(e){return new v(this.doc,this.body).addFolder(e)}addFeed(e,t){return new v(this.doc,this.body).addFeed(e,t)}_createHead(e){const t=this.getRoot().appendChild(this.doc.createElement("head"));return t.appendChild(this.doc.createElement("title")).appendChild(this.doc.createTextNode(e)),t}_createBody(){return this.getRoot().appendChild(this.doc.createElement("body"))}toString(){return new XMLSerializer().serializeToString(this.doc)}}class v{constructor(e,t){this.doc=e,this.root=t}addFolder(e){const t=this.doc.createElement("outline");return t.setAttribute("text",e),this.root.appendChild(t),new v(this.doc,t)}addFeed(e,t){const n=this.doc.createElement("outline");n.setAttribute("text",e),n.setAttribute("title",e),n.setAttribute("type","rss"),n.setAttribute("xmlUrl",t),this.root.appendChild(n)}}function st(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function nt(){return function(r,e){const t=e(),n=new rt("Brook Export");O.selectors.getTopLevelNodes(t).forEach(o=>{Z(t,n,o)}),st("brook_export.opml",n.toString())}}function Z(r,e,t){if(t.type===_){const n=e.addFolder(t.title);O.selectors.getChildren(r,t).forEach(o=>{Z(r,n,o)})}else e.addFeed(t.title,t.url)}class y extends d.Component{static propTypes={position:i.object.isRequired,onClose:i.func.isRequired,children:i.node.isRequired};render(){const{position:e,children:t,onClose:n}=this.props;return s.jsx("div",{className:"Modal PopupLayout",onClickCapture:n,children:s.jsx("div",{className:"Menu",style:e,children:t})})}}class it extends d.Component{static propTypes={position:i.object.isRequired,closeModal:i.func.isRequired,openModal:i.func.isRequired,addFolder:i.func.isRequired,exportOpml:i.func.isRequired};constructor(e){super(e)}render(){const{position:e,closeModal:t}=this.props;return s.jsxs(y,{position:e,onClose:t,children:[s.jsx("div",{children:s.jsx("a",{onClick:this.handleAddFolder,children:"Add Folder"})}),s.jsx("div",{children:s.jsx("a",{onClick:this.handleAddFeedByUrl,children:"Add Feed By URL"})}),s.jsx("div",{children:s.jsx("a",{href:browser.runtime.getURL("import.html"),children:"Import Feeds"})}),s.jsx("div",{children:s.jsx("a",{onClick:this.handleExport,children:"Export Feeds"})}),s.jsx("hr",{}),s.jsx("div",{children:s.jsx("a",{onClick:this.handleOptions,children:"Options"})})]})}handleAddFolder=()=>{this.props.closeModal();const e={title:"New Folder",isEditing:!0};this.props.addFolder(e)};handleAddFeedByUrl=()=>{this.props.openModal(f.AddByUrlMenu)};handleExport=()=>{this.props.exportOpml()};handleOptions(){browser.runtime.openOptionsPage()}}const ot=(r,e)=>({}),at=p(ot,{addFolder:oe,openModal:D,exportOpml:nt})(it);class lt extends d.Component{static propTypes={position:i.object.isRequired,closeModal:i.func.isRequired,changeView:i.func.isRequired,currentViewId:i.string.isRequired};render(){const{position:e,closeModal:t,changeView:n,currentViewId:o}=this.props;return s.jsx(y,{position:e,onClose:t,children:Object.keys(W).map(a=>s.jsx(dt,{viewId:a,changeView:n,isSelected:o===a},a))})}}class dt extends d.Component{static propTypes={changeView:i.func.isRequired,viewId:i.string.isRequired,isSelected:i.bool};render(){const{viewId:e,isSelected:t}=this.props,n=W[e];return s.jsx("div",{children:s.jsxs("a",{className:t?"isSelected":"",onClick:this.handleClick,children:[t!==void 0&&s.jsx("span",{className:"MenuItemRadioButton"}),n.longName]})})}handleClick=e=>{this.props.changeView(this.props.viewId)}}const ct=(r,e)=>({currentViewId:g.selectors.currentViewId(r)}),pt=p(ct,{changeView:ae})(lt);class ht extends d.Component{static propTypes={folder:i.object.isRequired,position:i.object.isRequired,closeModal:i.func.isRequired,editFolder:i.func.isRequired,removeBranch:i.func.isRequired};constructor(e){super(e),this.handleEdit=this.handleEdit.bind(this),this.handleRemove=this.handleRemove.bind(this)}render(){const{position:e,closeModal:t}=this.props;return s.jsxs(y,{position:e,onClose:t,children:[s.jsx("div",{children:s.jsx("a",{onClick:this.handleEdit,children:"Rename Folder"})}),s.jsx("div",{children:s.jsx("a",{onClick:this.handleRemove,children:"Delete Folder"})})]})}handleEdit(){this.handleClose(),this.props.editFolder(this.props.folder)}handleRemove(){this.handleClose(),this.props.removeBranch(this.props.folder)}handleClose(){this.props.closeModal()}}const ut=(r,e)=>({}),ft=p(ut,{editFolder:de,removeBranch:le})(ht);class mt extends d.Component{static propTypes={feed:i.object.isRequired,position:i.object.isRequired,closeModal:i.func.isRequired,editFeed:i.func.isRequired,removeFeed:i.func.isRequired};constructor(e){super(e),this.handleEdit=this.handleEdit.bind(this),this.handleRemove=this.handleRemove.bind(this)}render(){const{position:e,closeModal:t}=this.props;return s.jsxs(y,{position:e,onClose:t,children:[s.jsx("div",{children:s.jsx("a",{onClick:this.handleEdit,children:"Rename Feed"})}),s.jsx("div",{children:s.jsx("a",{onClick:this.handleRemove,children:"Delete Feed"})})]})}handleEdit(){this.handleClose(),this.props.editFeed(this.props.feed)}handleRemove(){this.handleClose(),this.props.removeFeed(this.props.feed)}handleClose(){this.props.closeModal()}}const gt=(r,e)=>({}),xt=p(gt,{editFeed:ce,removeFeed:K})(mt);class jt extends d.Component{static propTypes={position:i.object.isRequired,closeModal:i.func.isRequired,resetData:i.func.isRequired};constructor(e){super(e),this.handleReset=this.handleReset.bind(this),this.handleAddByUrl=this.handleAddByUrl.bind(this)}render(){const{position:e,closeModal:t}=this.props;return s.jsxs(y,{position:e,onClose:t,children:[s.jsx("h4",{children:"Debug Menu"}),s.jsx("div",{children:s.jsx("a",{href:"#",children:"Open in Browser"})}),s.jsx("hr",{}),s.jsx("div",{className:"isWarning",children:s.jsx("a",{onClick:this.handleReset,children:"Reset Data"})})]})}handleReset(){this.props.resetData()}}const yt=(r,e)=>({}),bt=p(yt,{resetData:pe})(jt),ee={SubscribeMenu:Ye,AddByUrlMenu:tt,FeedTreeMenu:at,TreeViewMenu:pt,FolderMenu:ft,FeedMenu:xt,DebugMenu:bt},f={};Object.keys(ee).forEach(r=>f[r]=r);te.propTypes={type:i.string,props:i.object,closeModal:i.func.isRequired};function te({type:r,props:e,closeModal:t}){let n=null;if(r){const o=ee[r];if(!o)throw console.error("Unknown modal type",r),new Error("Unknown modal type: "+r);n=s.jsx(ue,{classNames:"Modal",addEndListener:(a,l)=>{a.addEventListener("transitionend",l)},children:s.jsx(o,{closeModal:t,...e})})}return s.jsx(fe,{children:n})}const vt=p(r=>he.selectors.modal(r),{closeModal:z})(te);class wt extends d.PureComponent{static propTypes={nodes:i.array.isRequired,indent:i.number,indentUnits:i.string,currentFeed:i.object,currentFolder:i.object,hasAvailableFeeds:i.bool.isRequired,selectFolder:i.func.isRequired,renameFolder:i.func.isRequired,renameFeed:i.func.isRequired,selectFeed:i.func.isRequired,moveNode:i.func.isRequired,openModal:i.func.isRequired,allowDrop:i.func.isRequired,removeFeed:i.func.isRequired};static defaultProps={indent:1,indentUnits:"em"};constructor(e){super(e),this.handleShowImport=this.handleShowImport.bind(this),this.depthStyleCache=[]}getDepthStyle(e){if(!this.depthStyleCache[e]){const{indent:t,indentUnits:n}=this.props;this.depthStyleCache[e]={paddingLeft:t*e+n}}return this.depthStyleCache[e]}render(){const{nodes:e}=this.props;return e.length===0?this.props.hasAvailableFeeds?this.renderSubscribeEmptyState():this.renderEmptyState():this.renderContent(e)}renderEmptyState(){return s.jsxs("div",{className:"EmptyState layout-vertical",children:[s.jsx("h2",{children:"Getting Started"}),s.jsx($,{className:"layout-hero"}),s.jsxs("p",{children:[s.jsx("a",{href:"http://www.npr.org",children:"Visit"})," a site that publishes feeds, or ",s.jsx("a",{href:browser.runtime.getURL("import.html"),children:"import"})," existing ones."]})]})}renderSubscribeEmptyState(){return s.jsxs("div",{className:"EmptyState layout-vertical",children:[s.jsx("h2",{children:"Subscribe"}),s.jsx($,{className:"layout-hero"}),s.jsxs("p",{children:["Click the ",s.jsx("b",{children:"Subscribe"})," button to add this site to your feed list."]})]})}renderContent(e){return s.jsx("div",{className:"List",children:e.map(t=>this.renderNode(t))})}renderNode(e){const{currentFeed:t,currentFolder:n}=this.props,{item:o}=e,a=o===t||o===n,l={style:this.getDepthStyle(e.depth),className:`List-item ${a?"isSelected":""}`,key:`${o.type}-${o.id}`};switch(o.type){case me:return s.jsx(Be,{...l,feed:o,onDrop:this.props.moveNode,allowDrop:this.props.allowDrop,onClick:this.props.selectFeed,onRename:this.props.renameFeed,isUnread:e.isUnread});case _:return s.jsx(_e,{...l,folder:o,allowDrop:this.props.allowDrop,onDrop:this.props.moveNode,onClick:this.props.selectFolder,onRename:this.props.renameFolder});default:throw console.error("Unkown node type: ",o),new Error(`Unknown node type: ${o.type}`)}}handleShowImport(e){e.preventDefault(),this.props.openModal(f.ImportModal)}}const Ct=(r,e)=>({currentFeed:g.selectors.currentFeed(r),currentFolder:g.selectors.currentFolder(r),hasAvailableFeeds:H.selectors.hasAvailableFeeds(r,J.selectors.getActiveTabId(r)),allowDrop:(t,n)=>!O.selectors.containsNode(r,t,n)}),Rt=p(Ct,{selectFolder:be,selectFeed:ye,moveNode:je,openModal:D,renameFolder:xe,renameFeed:ge,removeFeed:K})(wt);function M(){return M=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},M.apply(this,arguments)}function Ft(r,e){if(r==null)return{};var t=St(r,e),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}function St(r,e){if(r==null)return{};var t={},n=Object.keys(r),o,a;for(a=0;a<n.length;a++)o=n[a],!(e.indexOf(o)>=0)&&(t[o]=r[o]);return t}var b=w.forwardRef(function(r,e){var t=r.color,n=t===void 0?"currentColor":t,o=r.size,a=o===void 0?24:o,l=Ft(r,["color","size"]);return d.createElement("svg",M({ref:e,xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},l),d.createElement("circle",{cx:"12",cy:"12",r:"1"}),d.createElement("circle",{cx:"12",cy:"5",r:"1"}),d.createElement("circle",{cx:"12",cy:"19",r:"1"}))});b.propTypes={color:i.string,size:i.oneOfType([i.string,i.number])};b.displayName="MoreVertical";function N(){return N=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},N.apply(this,arguments)}function kt(r,e){if(r==null)return{};var t=Mt(r,e),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}function Mt(r,e){if(r==null)return{};var t={},n=Object.keys(r),o,a;for(a=0;a<n.length;a++)o=n[a],!(e.indexOf(o)>=0)&&(t[o]=r[o]);return t}var q=w.forwardRef(function(r,e){var t=r.color,n=t===void 0?"currentColor":t,o=r.size,a=o===void 0?24:o,l=kt(r,["color","size"]);return d.createElement("svg",N({ref:e,xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},l),d.createElement("polyline",{points:"23 4 23 10 17 10"}),d.createElement("polyline",{points:"1 20 1 14 7 14"}),d.createElement("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"}))});q.propTypes={color:i.string,size:i.oneOfType([i.string,i.number])};q.displayName="RefreshCw";class Nt extends d.PureComponent{static propTypes={currentViewName:i.string.isRequired,unsubscribedFeeds:i.array.isRequired,isFetching:i.bool,addFeed:i.func.isRequired,fetchAll:i.func.isRequired,openModal:i.func.isRequired,openModalLeftAlignedBelow:i.func.isRequired,openModalRightAlignedBelow:i.func.isRequired};constructor(e){super(e),this.handleNewSubscription=this.handleNewSubscription.bind(this),this.handleMenu=this.handleMenu.bind(this)}render(){const{fetchAll:e,isFetching:t}=this.props;return s.jsxs("div",{className:"Panel-header",children:[s.jsx("span",{className:"isActionable",onClick:this.handleViewMenu,children:this.props.currentViewName}),s.jsxs("span",{children:[this.renderSubscribeButton(),s.jsx(q,{className:`Icon ${t?"isSpinning":""}`,title:"Refresh Feeds",onClick:e}),s.jsx(b,{className:"Icon",onClick:this.handleMenu})]})]})}renderSubscribeButton(){const{unsubscribedFeeds:e}=this.props;if(e.length!==0)return s.jsxs("a",{title:"Subscribe to Feed",onClick:this.handleNewSubscription,className:"isActive",children:["Subscribe",e.length>1?"… ":" "]})}handleNewSubscription(){const e=this.props.unsubscribedFeeds;if(e.length)e.length===1?this.props.addFeed(e[0],{fetch:!0}):this.props.openModal(f.SubscribeMenu,{feeds:e});else return}handleViewMenu=e=>{const t=e.target,n=f.TreeViewMenu;this.props.openModalLeftAlignedBelow(t,n)};handleMenu(e){const t=e.target,n=e.shiftKey?f.DebugMenu:f.FeedTreeMenu;this.props.openModalRightAlignedBelow(t,n)}}const Tt=(r,e)=>({currentViewName:g.selectors.currentViewName(r),unsubscribedFeeds:H.selectors.unsubscribedFeeds(r,J.selectors.getActiveTabId(r)),isFetching:ve.selectors.hasFeedWorkers(r)}),Et=p(Tt,{addFeed:E,fetchAll:Ce,openModal:D,openModalLeftAlignedBelow:we,openModalRightAlignedBelow:P})(Nt);class Ot extends d.Component{static propTypes={nodes:i.array.isRequired};componentDidMount(){if(this.scrollingElement){const e=this.scrollingElement.querySelector(".isSelected");e&&e.scrollIntoView(!0)}}setScrollingElement=e=>{this.scrollingElement=e};render(){const{nodes:e}=this.props;return s.jsx(C,{message:"An error ocurred while displaying your feeds.",children:s.jsxs("div",{className:"Panel",children:[s.jsx(Et,{}),s.jsx("div",{className:"Panel-body",ref:this.setScrollingElement,children:s.jsx(Rt,{nodes:e})})]})})}}const Dt=r=>({nodes:g.selectors.currentNodeList(r)}),Pt=p(Dt,{})(Ot);class At extends d.PureComponent{static propTypes={item:i.object.isRequired,isUnread:i.bool,onClick:i.func,style:i.object,className:i.string};static defaultProps={onClick:e=>!0,className:""};constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}render(){const{item:e,isUnread:t,style:n,className:o}=this.props,a=t?"isUnread":"isRead",l=e.error;return s.jsxs("div",{className:`Item ${a} ${o}`,style:n,children:[s.jsx(R,{isUnread:t,hasError:!!l}),l?this.renderError(l,e):this.renderLink(e)]})}renderLink(e){return s.jsx("a",{href:e.url,onClick:this.handleClick,title:e.title,children:e.title})}renderError(e,t){return s.jsx("span",{className:"hasError",onClick:this.handleClick,children:" Parse Error"})}handleClick(e){const t=this.props.item;t.error?(console.error("Brook Item Error:",t.error),console.error(t.data)):this.props.onClick(this.props.item)}}class qt extends d.PureComponent{static propTypes={itemNodes:i.array.isRequired,onClickItem:i.func};static defaultProps={onClickItem:e=>!0};render(){const{itemNodes:e,onClickItem:t}=this.props;return s.jsx("div",{className:"List",children:e.map(n=>s.jsx(At,{item:n.item,isUnread:n.isUnread,onClick:t,className:"List-item"},n.item.id))})}}class Lt extends d.PureComponent{static propTypes={feed:i.object,onUseAlternate:i.func.isRequired,onClickItem:i.func.isRequired,itemNodes:i.array.isRequired};constructor(e){super(e),this.handleUseAlternate=this.handleUseAlternate.bind(this)}render(){const{feed:e,itemNodes:t}=this.props;return e?e.error&&e.alternate&&e.alternate.url?this.renderFixFeedState(e):e.error?this.renderErrorState(e):t.length===0?this.renderEmptyState(e):this.renderContent(t):this.renderPendingState()}renderErrorState(e){return s.jsxs("div",{children:[s.jsxs("p",{className:"hasError",children:["There was an error reading this feed:  ",s.jsx("a",{href:e.url,children:"View page"})]}),s.jsx("p",{children:s.jsx("code",{children:e.error})})]})}renderFixFeedState(e){const t=e.alternate.url;return s.jsxs("div",{children:[s.jsxs("p",{className:"hasError",children:["Feed may have moved to"," "," ",s.jsx("a",{href:t,children:t})]}),s.jsx("p",{children:s.jsx("button",{className:"Button isActive",onClick:this.handleUseAlternate,children:"Update Url"})})]})}renderPendingState(){return s.jsx("p",{})}renderEmptyState(e){return s.jsx("p",{children:e.isLoading?"Loading…":"No published articles"})}renderContent(e){return s.jsx(qt,{itemNodes:e,onClickItem:this.props.onClickItem})}handleUseAlternate(){const e=this.props.feed;this.props.onUseAlternate(e)}}function T(){return T=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},T.apply(this,arguments)}function $t(r,e){if(r==null)return{};var t=It(r,e),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}function It(r,e){if(r==null)return{};var t={},n=Object.keys(r),o,a;for(a=0;a<n.length;a++)o=n[a],!(e.indexOf(o)>=0)&&(t[o]=r[o]);return t}var L=w.forwardRef(function(r,e){var t=r.color,n=t===void 0?"currentColor":t,o=r.size,a=o===void 0?24:o,l=$t(r,["color","size"]);return d.createElement("svg",T({ref:e,xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},l),d.createElement("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),d.createElement("polyline",{points:"22 4 12 14.01 9 11.01"}))});L.propTypes={color:i.string,size:i.oneOfType([i.string,i.number])};L.displayName="CheckCircle";class Ut extends d.PureComponent{static propTypes={feed:i.object.isRequired,itemNodes:i.array.isRequired,markAllItemsViewed:i.func.isRequired,clearSelection:i.func.isRequired,openModalRightAlignedBelow:i.func.isRequired};constructor(e){super(e),this.handleMarkAllRead=this.handleMarkAllRead.bind(this),this.handleBack=this.handleBack.bind(this),this.handleMenu=this.handleMenu.bind(this)}render(){const{feed:e,itemNodes:t}=this.props;return s.jsxs("div",{className:"Panel-header",children:[s.jsx("span",{children:this.renderTitle(e)}),s.jsx("span",{children:t.some(n=>n.isUnread)&&s.jsx(L,{className:"Icon",onClick:this.handleMarkAllRead})}),s.jsx("span",{children:s.jsx(b,{className:"Icon",onClick:this.handleMenu})})]})}renderTitle(e){const t=j.selectors.getFeedTitle(e);return t?s.jsx("a",{href:e.linkUrl,children:t}):"Articles"}handleMarkAllRead(){this.props.markAllItemsViewed(this.props.feed)}handleBack(){this.props.clearSelection()}handleMenu(e){const t=this.props.feed,n=e.target;this.props.openModalRightAlignedBelow(n,f.FeedMenu,{feed:t})}}const Bt=(r,e)=>({}),Vt=p(Bt,{markAllItemsViewed:Fe,clearSelection:Re,openModalRightAlignedBelow:P})(Ut);re.propTypes={feed:i.object,itemNodes:i.array.isRequired,useAlternateFeed:i.func.isRequired,onClickItem:i.func.isRequired};function re({feed:r,itemNodes:e,useAlternateFeed:t,onClickItem:n}){return s.jsx(C,{message:"An error ocurred while displaying this feed.",children:s.jsxs("div",{className:"Panel",children:[s.jsx(Vt,{feed:r,itemNodes:e}),s.jsx("div",{className:"Panel-body",children:s.jsx(Lt,{feed:r,itemNodes:e,onUseAlternate:t,onClickItem:n})})]})})}const zt=(r,e)=>({itemNodes:(e.feed.items||[]).map(t=>({item:t,isUnread:Me.selectors.isItemUnread(r,t)}))}),_t=p(zt,{useAlternateFeed:ke,onClickItem:Se})(re);class Wt extends d.PureComponent{static propTypes={folder:i.object.isRequired,openModalRightAlignedBelow:i.func.isRequired};constructor(e){super(e),this.handleMenu=this.handleMenu.bind(this)}render(){const{folder:e}=this.props;return s.jsxs("div",{className:"Panel-header",children:[s.jsx("span",{children:e.title||"Folder"}),s.jsx("span",{children:s.jsx(b,{className:"Icon",onClick:this.handleMenu})})]})}handleMenu(e){const t=this.props.folder,n=e.target;this.props.openModalRightAlignedBelow(n,f.FolderMenu,{folder:t})}}const Kt=(r,e)=>({}),Ht=p(Kt,{openModalRightAlignedBelow:P})(Wt);se.propTypes={folder:i.object};function se({folder:r}){return s.jsx(C,{message:"An error ocurred while displaying this folder.",children:s.jsx("div",{className:"Panel",children:s.jsx(Ht,{folder:r})})})}class Jt extends d.Component{static propTypes={currentFeed:i.object,currentFolder:i.object};render(){const{currentFeed:e,currentFolder:t}=this.props;return e?s.jsx(_t,{feed:e}):t?s.jsx(se,{folder:t}):s.jsx("div",{className:"Panel",children:s.jsx("div",{className:"Panel-header",children:"Articles"})})}}const Xt=r=>({currentFeed:g.selectors.currentFeed(r),currentFolder:g.selectors.currentFolder(r)}),Gt=p(Xt,{})(Jt);class Qt extends d.PureComponent{render(){return s.jsxs("div",{className:"layout-vertical",children:[s.jsx("div",{className:"layout-flex-2",children:s.jsx(Pt,{})}),s.jsx("div",{className:"layout-flex-1",children:s.jsx(Gt,{})})]})}}class Yt extends d.Component{render(){return s.jsx(C,{message:"An error ocurred while running Brook.",children:s.jsx(Qt,{})})}}const ne="macos",Zt="windows",er="linux",tr="ios",rr="android",sr="unknown";let u;function nr(){if(u)return u;const r=window.navigator.userAgent,e=window.navigator.platform,t=["Macintosh","MacIntel","MacPPC","Mac68K"],n=["Win32","Win64","Windows","WinCE"],o=["iPhone","iPad","iPod"];return t.indexOf(e)!==-1?u=ne:o.indexOf(e)!==-1?u=tr:n.indexOf(e)!==-1?u=Zt:/Android/.test(r)?u=rr:/Linux/.test(e)?u=er:u=sr,u}function ir(r){if(r.isDefaultPrevented()||r.button!==0)return;const e=r.target;if(e.nodeName==="A"){const t=e.getAttribute("href");t&&t[0]!=="#"&&(or(e.getAttribute("href"),r),r.preventDefault())}}function or(r,e){ar(e)?browser.tabs.create({url:r,active:e.shiftKey}):lr(e)?browser.windows.create({url:r}):browser.tabs.update({url:r})}function ar(r){return nr()===ne?r.metaKey:r.ctrlKey}function lr(r){return r.shiftKey}Ne();const dr=Te();Ee.render(s.jsx(De,{store:dr,children:s.jsxs("div",{className:"Root",onClick:ir,children:[s.jsx(Yt,{}),s.jsx(Oe,{}),s.jsx(vt,{})]})}),document.body);
