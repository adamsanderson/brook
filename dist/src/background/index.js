import{I as b,y as d,o as n,a0 as p,i as w,a1 as u,a2 as a,a3 as l,M as g}from"../../store.js";function A(e,r){let o={};e.subscribe(()=>{const i=e.getState(),t=c(i);(t.canSubscribe!==o.canSubscribe||t.isUnread!==o.isUnread||t.viewMode!==o.viewMode)&&(o=t,r(t))})}function c(e){const r=b.selectors.getActiveTabId(e);return{canSubscribe:d.selectors.unsubscribedFeeds(e,r).length>0,isUnread:p.selectors.isUnread(e),viewMode:n.selectors.getViewMode(e)}}const S=60*1e3;w();const s=u();browser.browserAction.onClicked.addListener(()=>{const e=s.getState();n.selectors.getViewMode(e)==="sidebar"?c(e).canSubscribe?(browser.browserAction.setPopup({popup:"subscribePopup.html"}),browser.browserAction.openPopup(),browser.browserAction.setPopup({popup:""})):browser.sidebarAction.open():(browser.sidebarAction.close(),browser.browserAction.setPopup({popup:"popup.html"}),browser.browserAction.openPopup(),browser.browserAction.setPopup({popup:""}))});browser.tabs.onActivated.addListener(e=>s.dispatch(a(e.tabId)));browser.tabs.onUpdated.addListener(e=>s.dispatch(a(e)));browser.tabs.onRemoved.addListener(e=>s.dispatch(l(e)));browser.browserAction.setBadgeTextColor({color:"#FFFFFF"});browser.browserAction.setBadgeBackgroundColor({color:"#617CBA"});A(s,(e=>{e.isUnread&&e.viewMode!=="sidebar"?browser.browserAction.setBadgeText({text:"★"}):e.canSubscribe?browser.browserAction.setBadgeText({text:"✚"}):browser.browserAction.setBadgeText({text:""})}));setInterval(()=>{navigator.onLine&&s.dispatch(g())},15*S);
